<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>
    <body>
        <!-- Header -->
        <div class="container">
            <nav>
                <div class="left-section">
                    <img src="logos/crypto.png" class="logo">
                    <div class="market-selector">
                        <label style="color:white;" for="market-select">Select Market:</label>
                        <select id="market-select" name="market">
                            <option value="BTC-USD">Bitcoin (BTC) - USD</option>
                            <option value="ETH-USD">Ethereum (ETH) - USD</option>
                            <option value="USDT-USD">Tether (USDT) - USD</option>
                            <option value="BNB-USD">Binance Coin (BNB) - USD</option>
                            <option value="XRP-USD">XRP (XRP) - USD</option>
                            <!-- trading pairs  -->
                        </select>
                    </div>
                    <ul>
                        <li><a href="#">Trade</a></li>
                    </ul>
                </div>
                <a href="login.html" class="log">Log in</a>
            </nav>
        </div>

        <!-- Left panel -->
        <div class="crypto-dashboard">
            <div class="left-panel">
                <div class="header">
                    <h4 class="trade">Start trading</h4>
                </div>

                <!-- Buy and sell section -->
                <div class="buy-sell">
                    <button id="buy-button">Buy</button>
                    <button id="sell-button">Sell</button>
                </div>
                <div class="crypto-details">
                    <h3 id="trading-pair-name">Bitcoin (BTC)</h3>
                    <p>Price: $<span id="crypto-value">0.00</span></p>
                </div>

                <!-- Wallet section -->
                <div class="user-wallet">
                    <h2 style="color:white;">My Wallet</h2>
                    <div class="wallet-item">
                        <div class="wallet-logo">
                            <img src="logos/bitcoin.png" alt="Bitcoin Logo">
                        </div>
                        <div class="wallet-details">
                            <h3 style="color:white">Bitcoin (BTC)</h3>
                            <p>Balance: <span id="wallet-balance-btc">0.00</span> BTC</p>
                        </div>
                    </div>
                    <div class="wallet-item">
                        <div class="wallet-logo">
                            <img src="logos/ethereum.png" alt="Ethereum Logo">
                        </div>
                        <div class="wallet-details">
                            <h3 style="color:white;">Ethereum (ETH)</h3>
                            <p>Balance: <span id="wallet-balance-eth">0.00</span> ETH</p>
                        </div>
                    </div>
                    <div class="wallet-item">
                        <div class="wallet-logo">
                            <img src="logos/tether.png" alt="Tether Logo">
                        </div>
                        <div class="wallet-details">
                            <h3 style="color:white">Tether (USDT)</h3>
                            <p>Balance: <span id="wallet-balance-tet">0.00</span> USDT</p>
                        </div>
                    </div>
                    <div class="wallet-item">
                        <div class="wallet-logo">
                            <img src="logos/binance-Coin.png" alt="Binance Coin Logo">
                        </div>
                        <div class="wallet-details">
                            <h3 style="color:white">Binance Coin (BNB)</h3>
                            <p>Balance: <span id="wallet-balance-bin">0.00</span> BNB</p>
                        </div>
                    </div>
                    <div class="wallet-item">
                        <div class="wallet-logo">
                            <img src="logos/xrp.png" alt="XRP Logo">
                        </div>
                        <div class="wallet-details">
                            <h3 style="color:white">XRP (XRP)</h3>
                            <p>Balance: <span id="wallet-balance-xrp">0.00</span> XRP</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right panel -->
            <div class="right-panel">
                <!-- Top graph section -->
                <!-- TradingView Widget BEGIN -->
                <div class="tradingview-widget-container">
                    <div id="tradingview_afe69"></div>
                    <div class="tradingview-widget-copyright"><a href="https://www.tradingview.com/" rel="noopener nofollow" target="_blank"><span class="blue-text">Track all markets on TradingView</span></a></div>
                    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
                    <script type="text/javascript">
                    new TradingView.widget(
                    {
                    "autosize": true,
                    "symbol": "COINBASE:BTCUSD",
                    "timezone": "Etc/UTC",
                    "interval": "D",
                    "theme": "dark",
                    "style": "1",
                    "locale": "en",
                    "enable_publishing": true,
                    "withdateranges": true,
                    "range": "YTD",
                    "hide_side_toolbar": false,
                    "allow_symbol_change": true,
                    "details": true,
                    "hotlist": true,
                    "calendar": true,
                    "show_popup_button": true,
                    "popup_width": "1000",
                    "popup_height": "650",
                    "container_id": "tradingview_afe69"
                }
                    );
                    </script>
                </div>
                <!-- TradingView Widget END -->

                <!-- Bottom graph section -->
                <!-- TradingView Widget BEGIN -->
                <div class="tradingview-widget-container">
                    <div id="tradingview_afe70"></div>
                    <div class="tradingview-widget-container__widget"></div>
                    <div class="tradingview-widget-copyright"><a href="https://www.tradingview.com/" rel="noopener nofollow" target="_blank"><span class="blue-text">Track all markets on TradingView</span></a></div>
                    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-screener.js" async>
                    {
                    "width": "100%",
                    "height": "900",
                    "defaultColumn": "overview",
                    "screener_type": "crypto_mkt",
                    "displayCurrency": "USD",
                    "colorTheme": "dark",
                    "locale": "en"
                }
                    
                    </script>
                </div>
                <!-- TradingView Widget END -->

                <!-- javaScript for the select market dropdown menu to update the graph -->
                <script type="text/javascript">
                    // Load the TradingView library
                    const script = document.createElement('script');
                    script.src = 'https://s3.tradingview.com/tv.js';
                    script.async = true;
                    document.body.appendChild(script);

                    script.onload = () => {
                        // To update the prices of the trading pairs in the Start Trading selection (but doesn't work for now)
                        async function getLatestPrice(tradingPair) {
                            try {
                                const coin = tradingPair.split(':')[1].slice(0, -3).toLowerCase();  // Convert trading pair to coin id
                                const response = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${coin}&vs_currencies=usd`);
                                const data = await response.json();
                                console.log(data);  // Log the data to see what's being returned
                                return data[coin].usd.toFixed(2);
                            } catch (error) {
                                console.error('Error fetching price:', error);
                                return '0.00';  // Return '0.00' on error
                            }
                        }

                        function getDisplayName(tradingPair) {
                            switch (tradingPair) {
                                case 'COINBASE:BTCUSD':
                                    return 'Bitcoin (BTC)';
                                case 'COINBASE:ETHUSD':
                                    return 'Ethereum (ETH)';
                                case 'COINBASE:USDTUSD':
                                    return 'Tether (USDT)';
                                case 'COINBASE:BNBUSD':
                                    return 'Binance Coin (BNB)';
                                case 'COINBASE:XRPUSD':
                                    return 'XRP (XRP)';
                                default:
                                    console.error('Unknown trading pair:', tradingPair);
                                    return '';
                            }
                        }
                        
                        // Update the name and price
                        async function updateTradingPairInfo(tradingPair) {  // Marked as async
                            const name = getDisplayName(tradingPair);
                            const price = await getLatestPrice(tradingPair);  // Await the price
                            
                            // Update the DOM
                            document.getElementById('trading-pair-name').textContent = name;
                            document.getElementById('crypto-value').textContent = price;
                        }

                        function updateChart(tradingPair) {
                            const tradingViewOptions = {
                                autosize: true,
                                symbol: tradingPair,
                                timezone: "Etc/UTC",
                                interval: "D",
                                theme: "dark",
                                style: "1",
                                locale: "en",
                                enable_publishing: true,
                                withdateranges: true,
                                range: "YTD",
                                hide_side_toolbar: false,
                                allow_symbol_change: true,
                                details: true,
                                hotlist: true,
                                calendar: true,
                                show_popup_button: true,
                                popup_width: "1000",
                                popup_height: "650",
                                container_id: 'tradingview_afe69'
                            };
                    
                            // Update the top chart
                            document.getElementById('tradingview_afe69').innerHTML = '';
                            new TradingView.widget(tradingViewOptions);
                    
                        }
                    
                        document.getElementById('market-select').addEventListener('change', function() {
                            const selectedMarket = document.getElementById('market-select').value;
                            let tradingPair;
                            switch(selectedMarket) {
                                case 'ETH-USD':
                                    tradingPair = 'COINBASE:ETHUSD';
                                    break;
                                case 'USDT-USD':
                                    tradingPair = 'COINBASE:USDTUSD';
                                    break;
                                case 'BNB-USD':
                                    tradingPair = 'COINBASE:BNBUSD';
                                    break;
                                case 'XRP-USD':
                                    tradingPair = 'COINBASE:XRPUSD';
                                    break;
                                default:
                                    tradingPair = 'COINBASE:BTCUSD';  // Default to Bitcoin if no match
                            }
                            updateChart(tradingPair);
                            updateTradingPairInfo(tradingPair);  // Update the trading pair info
                        });

                        // Initial Chart Load
                        updateChart('COINBASE:BTCUSD');
                        updateTradingPairInfo('COINBASE:BTCUSD');  // Initial trading pair info load
                    };
    
                </script>
            </div>
        </div>

    </body>
</html>
